function F(){const e=window.matchMedia("(prefers-color-scheme: dark)");function t(n){const a=document.documentElement;a.classList.toggle("spectrum--dark",n),a.classList.toggle("spectrum--light",!n)}t(e.matches),e.addEventListener("change",n=>t(n.matches))}async function I(e){const t=typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`;return new Promise((n,a)=>{function r(l){const s=l.data;!s||typeof s!="object"||s.correlationId===t&&(s.type==="SBA_APPLY_DONE"?(window.removeEventListener("message",r),n()):s.type==="SBA_APPLY_ERROR"&&(window.removeEventListener("message",r),a(new Error(String(s.error)))))}window.addEventListener("message",r),window.parent.postMessage({type:"SBA_APPLY_BRAND_KIT",payload:e,correlationId:t},"*")})}async function k(e){if(e.url)try{const n=await(await fetch("/api/analyze/colors",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageUrl:e.url})})).json();if(Array.isArray(n.swatches))return A(n.swatches)}catch{}return A([{name:"Primary",hex:"#0A84FF",role:"primary"},{name:"Secondary",hex:"#34C759",role:"secondary"},{name:"Accent",hex:"#FF9500",role:"accent"},{name:"Background",hex:"#FFFFFF",role:"bg"},{name:"Surface",hex:"#F2F2F7",role:"surface"},{name:"Text",hex:"#111111",role:"text"}])}function A(e){const t=["primary","secondary","accent","bg","surface","text"];return e.slice(0,8).map((n,a)=>({name:String(n.name??`Color ${a+1}`),hex:String(n.hex??n.color??"#888888").toUpperCase(),role:n.role??t[Math.min(a,t.length-1)]}))}async function C(e){try{const n=await(await fetch("/api/analyze/fonts",{method:"POST"})).json();if(n?.primary)return{primary:n.primary,secondary:n.options?.[1]}}catch{}return{primary:{family:"Inter",source:"google-fonts",weights:[400,600]},secondary:{family:"Roboto",source:"google-fonts",weights:[400,700]}}}async function M(e){try{const n=await(await fetch("/api/analyze/tone",{method:"POST"})).json();return R(String(n?.tone??"friendly"))}catch{return"friendly"}}function R(e){return{friendly:"friendly",bold:"bold",minimal:"minimal",playful:"playful",professional:"professional"}[e.toLowerCase()]??"friendly"}function y(e,t){const n=h(f(e)),a=h(f(t)),[r,l]=n>a?[n,a]:[a,n];return(r+.05)/(l+.05)}function U(e,t){if(y(e,t)>=4.5)return{fg:e,bg:t,passes:!0};const a=f(e),r=f(t),l=h(a)>h(r),s=u=>{let c=a;for(let m=0;m<30&&y(g(c),t)<4.5;m++)c=u==="darken"?K(c,.06):H(c,.06);return{color:g(c),ratio:y(g(c),t)}},o=s(l?"darken":"lighten"),i=s(l?"lighten":"darken"),d=o.ratio>=i.ratio?o:i;return{fg:d.color,bg:t,passes:d.ratio>=4.5}}function f(e){const t=e.replace("#",""),n=t.length===3?t.split("").map(r=>r+r).join(""):t,a=parseInt(n,16);return{r:a>>16&255,g:a>>8&255,b:a&255}}function g(e){const t=n=>n.toString(16).padStart(2,"0");return`#${t(b(e.r))}${t(b(e.g))}${t(b(e.b))}`.toUpperCase()}function b(e){return Math.max(0,Math.min(255,Math.round(e)))}function h({r:e,g:t,b:n}){const a=[e,t,n].map(o=>o/255).map(o=>o<=.03928?o/12.92:Math.pow((o+.055)/1.055,2.4)),[r,l,s]=a;return .2126*r+.7152*l+.0722*s}function H(e,t){return{r:e.r+255*t,g:e.g+255*t,b:e.b+255*t}}function K(e,t){return{r:e.r-255*t,g:e.g-255*t,b:e.b-255*t}}function L(e){const t=document.createElement("div");t.className="sba-col";const n=document.createElement("table");n.className="spectrum-Table";const a=document.createElement("tr");a.innerHTML="<th>Foreground</th><th>Background</th><th>Ratio</th><th>AA</th><th>AAA</th><th>Suggestion</th>",n.appendChild(a);const r=e.palette.filter(s=>["text","primary","secondary"].includes(s.role)),l=e.palette.filter(s=>["bg","surface","primary","secondary"].includes(s.role));for(const s of r)for(const o of l){const i=y(s.hex,o.hex),d=document.createElement("tr"),u=i>=4.5,c=i>=7;let m="";if(!u){const B=U(s.hex,o.hex);m=`${B.fg} / ${B.bg}`}d.innerHTML=`<td><span class="swatch" style="background:${s.hex}"></span> ${s.hex}</td><td><span class="swatch" style="background:${o.hex}"></span> ${o.hex}</td><td>${i.toFixed(2)}</td><td>${u?"Pass":"Fail"}</td><td>${c?"Pass":"—"}</td><td>${m}</td>`,n.appendChild(d)}return t.appendChild(n),t}function T(e){const t=[{name:"IG Post",w:1080,h:1080},{name:"IG Story",w:1080,h:1920},{name:"Flyer",w:816,h:1056},{name:"Email Header",w:1200,h:400},{name:"Presentation",w:1920,h:1080}],n=e.palette.find(r=>r.role==="primary")?.hex??"#0A84FF",a=e.palette.find(r=>r.role==="text")?.hex??"#111111";return t.map(r=>{const l=document.createElement("div");l.className="sba-col",l.style.border="1px solid var(--spectrum-global-color-gray-300)",l.style.padding="8px",l.innerHTML=`<div style="width:100%; aspect-ratio:${r.w}/${r.h}; background:${n}; color:${a}; display:flex; align-items:center; justify-content:center; font-family:${e.fonts.primary.family}">${r.name}</div>`;const s=document.createElement("button");return s.className="spectrum-Button",s.innerHTML='<span class="spectrum-Button-label">Open in Editor</span>',s.addEventListener("click",()=>{window.alert(`${r.name} would open in the editor.`)}),l.appendChild(s),l})}const P="sba.brandkit";function N(e){try{localStorage.setItem(P,JSON.stringify(e))}catch{}}function O(){try{const e=localStorage.getItem(P);return e?JSON.parse(e):null}catch{return null}}async function j(e){try{await fetch("/api/brandkit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}catch{}}async function z(){try{const e=await fetch("/api/brandkit");return e.ok?await e.json():null}catch{return null}}const D={logo:{url:""}};async function _(e){const t=e.onProgress??(()=>{});t(10);const n=O()??await z();if(!e.file&&!e.url&&!e.handle&&n){const u=T(n),c=L(n);return t(100),{kit:n,renders:{previews:u,a11y:c}}}let a=null;if(e.file)a=await J(e.file);else if(e.url)try{a=(await q(e.url)).logo??null}catch{a=null}t(25);const r=await k({imageDataUrl:a,url:e.url});t(55);const l=await C();t(75);const s=await M(),o={palette:r,fonts:l,tone:s,logo:a?{url:a}:D.logo};t(85);const i=T(o),d=L(o);return t(100),N(o),j(o),{kit:o,renders:{previews:i,a11y:d}}}async function q(e){const t=await fetch(`/api/hints?url=${encodeURIComponent(e)}`);if(!t.ok)throw new Error("Failed to fetch site hints");return await t.json()}function J(e){return new Promise((t,n)=>{const a=new FileReader;a.onerror=()=>n(a.error),a.onload=()=>t(String(a.result)),a.readAsDataURL(e)})}F();const E=document.getElementById("app");E.setAttribute("aria-busy","true");E.innerHTML=`
  <div class="sba-shell">
    <aside class="sba-left" aria-label="Input panel">
      <div class="sba-col">
        <label class="spectrum-FieldLabel">Logo image
          <input id="logoFile" class="spectrum-Textfield" type="file" accept="image/*" />
        </label>
        <label class="spectrum-FieldLabel">Website URL
          <input id="siteUrl" class="spectrum-Textfield" type="url" placeholder="https://example.com" />
        </label>
        <label class="spectrum-FieldLabel">Social handle
          <input id="social" class="spectrum-Textfield" type="text" placeholder="@brand" />
        </label>
        <button id="analyzeBtn" class="spectrum-Button spectrum-Button--cta"><span class="spectrum-Button-label">Analyze Brand</span></button>
        <div id="status" role="status" aria-live="polite"></div>
        <progress id="progress" class="spectrum-ProgressBar" max="100" value="0" aria-label="Analysis progress"></progress>
        <button id="saveApply" class="spectrum-Button" disabled><span class="spectrum-Button-label">One-click Brand Kit</span></button>
      </div>
    </aside>
    <main id="main" class="sba-right" tabindex="-1">
      <div class="spectrum-Tabs" role="tablist" aria-label="Results tabs">
        <button class="spectrum-Tabs-item is-selected" role="tab" aria-selected="true" data-tab="kit">Brand Kit</button>
        <button class="spectrum-Tabs-item" role="tab" aria-selected="false" data-tab="preview">Mood Preview</button>
        <button class="spectrum-Tabs-item" role="tab" aria-selected="false" data-tab="templates">Templates</button>
        <button class="spectrum-Tabs-item" role="tab" aria-selected="false" data-tab="a11y">Accessibility</button>
      </div>
      <section id="panel-kit" class="tab-panels"></section>
      <section id="panel-preview" class="tab-panels" hidden></section>
      <section id="panel-templates" class="tab-panels" hidden></section>
      <section id="panel-a11y" class="tab-panels" hidden></section>
    </main>
  </div>
`;E.setAttribute("aria-busy","false");const S=Array.from(document.querySelectorAll(".spectrum-Tabs-item"));S.forEach(e=>{e.addEventListener("click",()=>{S.forEach(n=>{n.classList.remove("is-selected"),n.setAttribute("aria-selected","false")}),e.classList.add("is-selected"),e.setAttribute("aria-selected","true");const t=e.dataset.tab;document.querySelectorAll(".tab-panels").forEach(n=>n.hidden=!0),document.getElementById(`panel-${t}`).hidden=!1,document.getElementById("main").focus()})});const w=document.getElementById("analyzeBtn"),$=document.getElementById("saveApply"),p=document.getElementById("status"),v=document.getElementById("progress");let x=null;w.addEventListener("click",async()=>{w.disabled=!0,p.textContent="Analyzing…",v.value=5;try{const e=document.getElementById("logoFile").files?.[0]??null,t=document.getElementById("siteUrl").value||null,n=document.getElementById("social").value||null,{kit:a,renders:r}=await _({file:e,url:t,handle:n,onProgress:l=>v.value=l});x=a,$.disabled=!1,p.textContent="Analysis complete.",Y(a,r),document.querySelector('[data-tab="kit"]')?.dispatchEvent(new Event("click"))}catch(e){console.error(e),p.textContent="Analysis failed. Check inputs or try mock mode."}finally{w.disabled=!1,v.value=0}});$.addEventListener("click",async()=>{if(x){p.textContent="Applying Brand Kit to document…";try{await I(x),p.textContent="Brand Kit applied."}catch(e){console.error(e),p.textContent="Failed to apply in the editor."}}});function Y(e,t){const n=document.getElementById("panel-kit");n.innerHTML="";const a=document.createElement("div");a.className="palette-grid";for(const o of e.palette){const i=document.createElement("div");i.className="swatch",i.style.background=o.hex,i.title=`${o.role}: ${o.hex}`,a.appendChild(i)}const r=document.createElement("div");r.innerHTML=`<div>Primary font: <strong>${e.fonts.primary.family}</strong></div>`+(e.fonts.secondary?`<div>Secondary font: <strong>${e.fonts.secondary.family}</strong></div>`:"")+`<div>Tone: ${e.tone}</div>`,n.append(a,r);const l=document.getElementById("panel-preview");l.innerHTML="",t.previews.forEach(o=>l.appendChild(o));const s=document.getElementById("panel-a11y");s.innerHTML="",s.appendChild(t.a11y)}
//# sourceMappingURL=iframe.js.map
